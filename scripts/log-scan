#!/usr/bin/env bash
set -euo pipefail

file="${1:-}"
if [[ -z "$file" || ! -f "$file" ]]; then
  echo "Usage: scripts/log-scan <log-file>"
  exit 1
fi

echo "== Top error signatures =="
rg -n "error|exception|failed|timeout|refused|panic" "$file" -i | awk -F: '{print $3}' | sed 's/^ *//' | sort | uniq -c | sort -nr | sed -n '1,20p'

echo

echo "== First 30 matching log lines =="
rg -n "error|exception|failed|timeout|refused|panic" "$file" -i | sed -n '1,30p'
